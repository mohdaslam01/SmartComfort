<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Threshold Setup with Range</title>
    <style>
        :root{
            --bg-cream:#f7f6f2;
            --bg-blue-soft:#eaf3fb;
            --bg-green-soft:#eef8f3;
            --card:#ffffff;
            --stroke:#dfe7ee;
            --txt:#243447;
            --txt-muted:#5b6b7a;
            --accent:#3aa0c8;      /* light blue */
            --accent-2:#46b57a;    /* light green */
            --accent-3:#f4e9d8;    /* light creamy */
            --shadow:0 6px 18px rgba(28, 55, 90, 0.08);
            --radius:16px;
        }

        /* Page */
        html,body{height:100%;}
        body {
            font-family: Arial, Helvetica, sans-serif;
            color: var(--txt);
            background:
                radial-gradient(1200px 600px at 10% -10%, var(--bg-blue-soft), transparent 60%),
                radial-gradient(900px 500px at 110% 10%, var(--bg-green-soft), transparent 60%),
                radial-gradient(600px 300px at -10% 110%, var(--accent-3), transparent 60%),
                var(--bg-cream);
            margin: 0;
            padding: 24px;
            line-height: 1.45;
        }
        /* Layout width without changing your structure */
        body > * { max-width: 1100px; margin-left: auto; margin-right: auto; }

        /* Headings */
        h1{
            margin: 0 0 18px 0;
            padding: 18px 20px;
            border-radius: var(--radius);
            background: linear-gradient(135deg, #ffffff, #f6fbff 40%, #f3fff8 100%);
            border: 1px solid var(--stroke);
            box-shadow: var(--shadow);
            color: var(--txt);
            letter-spacing: 0.2px;
        }
        h2{
            margin-top: 26px;
            color: var(--txt);
            letter-spacing: 0.3px;
            position: relative;
            padding-left: 12px;
        }
        h2::before{
            content:"";
            position:absolute;
            left:0; top: 6px; bottom: 6px;
            width:6px;
            border-radius:6px;
            background: linear-gradient(180deg, var(--accent), var(--accent-2));
            opacity: .85;
        }

        /* Card sections (your existing .container blocks) */
        .container{
            background: var(--card);
            border: 1px solid var(--stroke);
            border-radius: var(--radius);
            padding: 14px;
            margin-bottom: 16px;
            box-shadow: var(--shadow);
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        }

        /* Labels + inputs (without changing your HTML) */
        label{
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 14px;
            color: var(--txt-muted);
            background: linear-gradient(180deg, #ffffff, #fbfdff);
            border: 1px solid var(--stroke);
            padding: 10px 12px;
            border-radius: 12px;
        }
        input{
            padding: 12px 10px;
            margin: 0;
            border: 1px solid var(--stroke);
            border-radius: 10px;
            outline: none;
            transition: box-shadow .2s ease, border-color .2s ease, transform .05s ease;
            background: #fff;
            color: var(--txt);
        }
        input:focus{
            border-color: #b7e3ff;
            box-shadow: 0 0 0 4px rgba(63, 163, 222, 0.18);
        }

        /* Buttons (your existing button stays, styling only) */
        button{
            padding: 12px 16px;
            margin: 5px;
            border: 1px solid #bfe7f7;
            border-radius: 12px;
            background: linear-gradient(135deg, #eaf7ff, #e6fff4);
            color: #0f4a64;
            font-weight: 700;
            letter-spacing: .2px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform .06s ease, filter .15s ease, background .2s ease, color .2s ease;
        }
        button:hover{
            filter: brightness(1.03);
        }
        button:active{
            transform: translateY(1px);
            background: linear-gradient(135deg, #cfeeff, #d7ffe9);
            color: #05354a;
        }

        /* Status/Reports styling without touching IDs */
        #report1, #report2, #humidityReport1, #humidityReport2, #lightReport1, #lightReport2{
            margin-top: 16px;
            padding: 14px 16px;
            border-radius: 14px;
            border: 1px solid #cfe8d9;
            background: linear-gradient(180deg, #f3fff8, #ffffff);
            color: #1b6b42;
            font-weight: 700;
            box-shadow: var(--shadow);
        }
        /* Normal message */
        #normalMessage{
            margin-top: 18px;
            padding: 12px 14px;
            border-radius: 12px;
            background: linear-gradient(180deg, #f6fbff, #ffffff);
            border: 1px solid var(--stroke);
            color: #1b4b7a;
            font-weight: 600;
            box-shadow: var(--shadow);
        }

        /* Subtle helper text style (used for the new note at the end) */
        .note{
            margin-top: 22px;
            padding: 14px 16px;
            border-radius: 14px;
            border: 1px solid #efe2c9;
            background: linear-gradient(180deg, #fffaf0, #ffffff);
            color: #6b5b3a;
            box-shadow: var(--shadow);
        }

        /* Make the whole page feel airy */
        #report1::before, #report2::before,
        #humidityReport1::before, #humidityReport2::before,
        #lightReport1::before, #lightReport2::before{
            content: "✔ ";
            margin-right: 4px;
            color: var(--accent-2);
        }

        /* Small screens polish */
        @media (max-width: 520px){
            body{ padding: 18px; }
            h1{ font-size: 22px; }
            h2{ font-size: 18px; }
            label{ font-size: 13px; }
            input, button{ font-size: 14px; }
        }
    </style>
</head>
<body>
    <h3>SmartComfort</h3>

    <!-- First Range and Threshold (Existing) for Temperature -->
     <h2>Temperature</h2>
    <div class="container">
        <label>Lower Temperature 1 (°C): <input type="number" id="lowerRange1" value="18"></label>
        <label>Higher Temperature 1 (°C): <input type="number" id="higherRange1" value="22"></label>
        <label>Threshold 1 (°C): <input type="number" id="threshold1" value="0.05"></label>
        <button id="monitorButton" onclick="startMonitoring()">Start Monitoring</button>
    </div>

    <!-- Second Range and Threshold (New) for Temperature -->
    <div class="container">
        <label>Lower Temperature 2 (°C): <input type="number" id="lowerRange2" value="20"></label>
        <label>Higher Temperature 2 (°C): <input type="number" id="higherRange2" value="24"></label>
        <label>Threshold 2 (°C): <input type="number" id="threshold2" value="0.5"></label>
    </div>

    <h2>Humidity</h2>
    <!-- First Range and Threshold for Humidity -->
    <div class="container">
        <label>Lower Humidity 1 (%): <input type="number" id="lowerHumidity1" value="38"></label>
        <label>Higher Humidity 1 (%): <input type="number" id="higherHumidity1" value="60"></label>
        <label>Threshold 1 (%): <input type="number" id="thresholdHumidity1" value="0.5"></label>
    </div>

    <!-- Second Range and Threshold for Humidity -->
    <div class="container">
        <label>Lower Humidity 2 (%): <input type="number" id="lowerHumidity2" value="42"></label>
        <label>Higher Humidity 2 (%): <input type="number" id="higherHumidity2" value="58"></label>
        <label>Threshold 2 (%): <input type="number" id="thresholdHumidity2" value="0.1"></label>
    </div>

    <h2>Light</h2>
    <!-- First Range and Threshold for Ambient Light -->
    <div class="container">
        <label>Lower Light 1 (%): <input type="number" id="lowerLight1" value="90"></label>
        <label>Higher Light 1 (%): <input type="number" id="higherLight1" value="120"></label>
        <label>Threshold 1 (%): <input type="number" id="thresholdLight1" value="1"></label>
    </div>

    <!-- Second Range and Threshold for Ambient Light -->
    <div class="container">
        <label>Lower Light 2 (%): <input type="number" id="lowerLight2" value="1000"></label>
        <label>Higher Light 2 (%): <input type="number" id="higherLight2" value="12000"></label>
        <label>Threshold 2 (%): <input type="number" id="thresholdLight2" value="2"></label>
    </div>

    <!-- Separate Outputs for both Range 1 and Range 2 -->
    <div id="report1"></div> <!-- Output for Range 1 (Temperature) -->
    <div id="report2"></div> <!-- Output for Range 2 (Temperature) -->

    <div id="humidityReport1"></div> <!-- Output for Range 1 (Humidity) -->
    <div id="humidityReport2"></div> <!-- Output for Range 2 (Humidity) -->

    <div id="lightReport1"></div> <!-- Output for Range 1 (Ambient Light) -->
    <div id="lightReport2"></div> <!-- Output for Range 2 (Ambient Light) -->

    <div id="normalMessage">No changes detected yet...</div> <!-- Normal Message Section -->

    <!-- Your original script kept exactly the same -->
    <script>
        let previousAvg1 = null;
        let previousAvg2 = null;
        let previousAvgHumidity1 = null;
        let previousAvgHumidity2 = null;
        let previousAvgLight1 = null;
        let previousAvgLight2 = null;

        const dataPoints1 = [];
        const dataPoints2 = [];
        const dataPointsHumidity1 = [];
        const dataPointsHumidity2 = [];
        const dataPointsLight1 = [];
        const dataPointsLight2 = [];

        async function fetchData() {
            try {
                console.log("Fetching data...");
                const response = await fetch('http://10.202.14.3:5000/sensor-data');
                const data = await response.json();
                return {
                    temperature: parseFloat(data.temperature),
                    humidity: parseFloat(data.humidity),
                    lux: parseFloat(data.lux)
                };
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        function calculateAverage(arr) {
            return arr.reduce((a, b) => a + b, 0) / arr.length;
        }

        async function monitor() {
            const data = await fetchData();
            if (data === null) return;

            const { temperature, humidity, lux } = data;

            dataPoints1.push(temperature);
            if (dataPoints1.length === 3) {
                const currentAvg1 = calculateAverage(dataPoints1);
                if (previousAvg1 !== null) {
                    const difference1 = Math.abs(currentAvg1 - previousAvg1);
                    const lower1 = parseFloat(document.getElementById('lowerRange1').value);
                    const higher1 = parseFloat(document.getElementById('higherRange1').value);
                    const threshold1 = parseFloat(document.getElementById('threshold1').value);

                    if ((currentAvg1 < lower1 || currentAvg1 > higher1) || difference1 >= threshold1) {
                        document.getElementById('report1').innerText = `Alert for Range 1 (Temp): Avg Temp is ${currentAvg1.toFixed(2)} °C, changed by ${difference1.toFixed(2)} °C`;
                    }
                }
                previousAvg1 = currentAvg1;
                dataPoints1.length = 0;
            }

            dataPoints2.push(temperature);
            if (dataPoints2.length === 3) {
                const currentAvg2 = calculateAverage(dataPoints2);
                if (previousAvg2 !== null) {
                    const difference2 = Math.abs(currentAvg2 - previousAvg2);
                    const lower2 = parseFloat(document.getElementById('lowerRange2').value);
                    const higher2 = parseFloat(document.getElementById('higherRange2').value);
                    const threshold2 = parseFloat(document.getElementById('threshold2').value);

                    if ((currentAvg2 < lower2 || currentAvg2 > higher2) || difference2 >= threshold2) {
                        document.getElementById('report2').innerText = `Alert for Range 2 (Temp): Avg Temp is ${currentAvg2.toFixed(2)} °C, changed by ${difference2.toFixed(2)} °C`;
                    }
                }
                previousAvg2 = currentAvg2;
                dataPoints2.length = 0;
            }

            dataPointsHumidity1.push(humidity);
            if (dataPointsHumidity1.length === 3) {
                const currentAvgHumidity1 = calculateAverage(dataPointsHumidity1);
                if (previousAvgHumidity1 !== null) {
                    const differenceHumidity1 = Math.abs(currentAvgHumidity1 - previousAvgHumidity1);
                    const lowerHumidity1 = parseFloat(document.getElementById('lowerHumidity1').value);
                    const higherHumidity1 = parseFloat(document.getElementById('higherHumidity1').value);
                    const thresholdHumidity1 = parseFloat(document.getElementById('thresholdHumidity1').value);

                    if ((currentAvgHumidity1 < lowerHumidity1 || currentAvgHumidity1 > higherHumidity1) || differenceHumidity1 >= thresholdHumidity1) {
                        document.getElementById('humidityReport1').innerText = `Alert for Range 1 (Humidity): Avg Humidity is ${currentAvgHumidity1.toFixed(2)} %, changed by ${differenceHumidity1.toFixed(2)} %`;
                    }
                }
                previousAvgHumidity1 = currentAvgHumidity1;
                dataPointsHumidity1.length = 0;
            }

            dataPointsHumidity2.push(humidity);
            if (dataPointsHumidity2.length === 3) {
                const currentAvgHumidity2 = calculateAverage(dataPointsHumidity2);
                if (previousAvgHumidity2 !== null) {
                    const differenceHumidity2 = Math.abs(currentAvgHumidity2 - previousAvgHumidity2);
                    const lowerHumidity2 = parseFloat(document.getElementById('lowerHumidity2').value);
                    const higherHumidity2 = parseFloat(document.getElementById('higherHumidity2').value);
                    const thresholdHumidity2 = parseFloat(document.getElementById('thresholdHumidity2').value);

                    if ((currentAvgHumidity2 < lowerHumidity2 || currentAvgHumidity2 > higherHumidity2) || differenceHumidity2 >= thresholdHumidity2) {
                        document.getElementById('humidityReport2').innerText = `Alert for Range 2 (Humidity): Avg Humidity is ${currentAvgHumidity2.toFixed(2)} %, changed by ${differenceHumidity2.toFixed(2)} %`;
                    }
                }
                previousAvgHumidity2 = currentAvgHumidity2;
                dataPointsHumidity2.length = 0;
            }

            dataPointsLight1.push(lux);
            if (dataPointsLight1.length === 3) {
                const currentAvgLight1 = calculateAverage(dataPointsLight1);
                if (previousAvgLight1 !== null) {
                    const differenceLight1 = Math.abs(currentAvgLight1 - previousAvgLight1);
                    const lowerLight1 = parseFloat(document.getElementById('lowerLight1').value);
                    const higherLight1 = parseFloat(document.getElementById('higherLight1').value);
                    const thresholdLight1 = parseFloat(document.getElementById('thresholdLight1').value);

                    if ((currentAvgLight1 < lowerLight1 || currentAvgLight1 > higherLight1) || differenceLight1 >= thresholdLight1) {
                        document.getElementById('lightReport1').innerText = `Alert for Range 1 (Light): Avg Light is ${currentAvgLight1.toFixed(2)} lux, changed by ${differenceLight1.toFixed(2)} lux`;
                    }
                }
                previousAvgLight1 = currentAvgLight1;
                dataPointsLight1.length = 0;
            }

            dataPointsLight2.push(lux);
            if (dataPointsLight2.length === 3) {
                const currentAvgLight2 = calculateAverage(dataPointsLight2);
                if (previousAvgLight2 !== null) {
                    const differenceLight2 = Math.abs(currentAvgLight2 - previousAvgLight2);
                    const lowerLight2 = parseFloat(document.getElementById('lowerLight2').value);
                    const higherLight2 = parseFloat(document.getElementById('higherLight2').value);
                    const thresholdLight2 = parseFloat(document.getElementById('thresholdLight2').value);

                    if ((currentAvgLight2 < lowerLight2 || currentAvgLight2 > higherLight2) || differenceLight2 >= thresholdLight2) {
                        document.getElementById('lightReport2').innerText = `Alert for Range 2 (Light): Avg Light is ${currentAvgLight2.toFixed(2)} lux, changed by ${differenceLight2.toFixed(2)} lux`;
                    }
                }
                previousAvgLight2 = currentAvgLight2;
                dataPointsLight2.length = 0;
            }
        }

        function startMonitoring() {
            document.getElementById('report1').innerText = '';
            document.getElementById('report2').innerText = '';
            document.getElementById('normalMessage').innerText = 'Monitoring started...';
            setInterval(monitor, 60000);
        }
    </script>

    <!-- Note (added exactly as requested) -->
    <p class="note">
        <strong>Note:</strong> Output appears only if the temperature average is outside the set range or the change exceeds the specified threshold. Otherwise, the system remains silent and continues monitoring.
    </p>
</body>
</html>
